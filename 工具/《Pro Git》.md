## 第一章   起步

## 1.1 关于版本控制

许多人习惯用复制整个项目目录的方式来保存不同的版本，这么做唯一的好处就是简单，但是特别容易犯错



分布式版本控制系统（Distributed Version Control System，简称 DVCS）面世了

每一次的克隆操作，实际上都是一次对代码仓库的完整备份

更进一步，许多这类系统都可以指定和若干不同的远端代码仓库进行交互



## 1.3 Git基础

1. **直接记录快照，而非差异比较**

Git 更像是把数据看作是对小型文件系统的一组快照

每次你提交更新，或在 Git 中保存项目状态时，它主要对当时的全部文件制作一个快照并保存这个快照的索引

为了高效，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件



2. **近乎所有操作都是本地执行**

在 Git 中的绝大多数操作都只需要访问本地文件和资源，一般不需要来自网络上其它计算机的信息

要浏览项目的历史，Git 不需外连到服务器去获取历史，它只需直接从本地数据库中读取



3. **Git保证完整性**

Git 中所有数据在存储前都计算校验和，然后以校验和来引用

若你在传送过程中丢失信息或损坏文件，Git 就能发现



4. **三种状态**

Git有三种状态：

* 已提交（committed）：表示数据已经安全的保存在本地数据库中
* 已修改（modified）：表示修改了文件，但还没保存到数据库中
* 已暂存（staged）：对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中



三个区域：

* Git仓库：用来保存项目的元数据和对象数据库的地方，从其它计算机克隆仓库时，拷贝的就是这里的数据
* 工作目录：对项目的某个版本独立提取出来的内容，放在磁盘上供你使用或修改
* 暂存区域：是一个文件，保存了下次将提交的文件列表信息，一般在 Git 仓库目录中



工作流程：

* 在工作目录中修改文件
* 暂存文件，将文件的快照放入暂存区域
* 提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录



## 1.4 命令行

Git 有多种使用方式。 你可以使用原生的命令行模式，也可以使用 GUI 模式



## 1.5 初次运行Git前的配置

当安装完 Git 应该做的第一件事就是设置你的用户名称与邮件地址

```c
$ git config --global user.name "John Doe"
$ git config --global user.email johndoe@example.com
```



既然用户信息已经设置完毕，你可以配置默认文本编辑器了

如果你想使用不同的文本编辑器，例如 Emacs，可以这样做

```c
$ git config --global core.editor emacs
```



## 1.6 获取帮助

若你使用 Git 时需要获取帮助，有三种方法可以找到 Git 命令的使用手册：

```c
$ git help <verb>
$ git <verb> --help
$ man git-<verb>
```



例如，想要获得config命令的手册

```c
$ git help config
```



# 第二章   Git基础

## 2.1 获取Git仓库

两种取得Git项目仓库的方法：

* 在现有项目或目录下导入所有文件到 Git 中
* 从一个服务器克隆一个现有的 Git 仓库



1. **在现有目录中初始化仓库**

如果你打算使用 Git 来对现有的项目进行管理，你只需要进入该项目目录并输入

```c
$ git init
```

该命令将创建一个名为 `.git` 的子目录，这个子目录含有你初始化的 Git 仓库中所有的必须文件，这些文件是 Git 仓库的骨干

仅仅是做了一个初始化的操作，你的项目里的文件还没有被跟踪



如果你是在一个已经存在文件的文件夹（而不是空文件夹）中初始化 Git 仓库来进行版本控制的话，你应该开始跟踪这些文件并提交

可通过 `git add` 命令来实现对指定文件的跟踪，然后执行 `git commit` 提交

```c
git add *.c
git add LICENSE
git commit -m 'initial project version'
```



2. **克隆现有仓库**

如果你想获得一份已经存在了的 Git 仓库的拷贝，这时就要用到 `git clone` 命令

Git 克隆的是该 Git 仓库服务器上的几乎所有数据

当你执行 `git clone` 命令的时候，默认配置下远程 Git 仓库中的每一个文件的每一个版本都将被拉取下来



```c
git clone https://github.com/libgit2/libgit2
```

这会在当前目录下创建一个名为 libgit2的目录，并在这个目录下初始化一个 `.git` 文件夹，从远程仓库拉取下所有数据放入` .git` 文件夹，然后从中读取最新版本的文件的拷贝



如果你想在克隆远程仓库的时候，自定义本地仓库的名字

```c
git clone https://github.com/libgit2/libgit2 mylibgit
```



Git 支持多种数据传输协议。 上面的例子使用的是 `https://` 协议，不过你也可以使用 `git://` 协议或者使用 SSH 传输协议



## 2.2 记录每次更新到仓库

你工作目录下的每一个文件都不外乎这两种状态：已跟踪或未跟踪



已跟踪的文件是指那些被纳入了版本控制的文件，在上一次快照中有它们的记录，在工作一段时间后，它们的状态可能处于未修改，已修改或已放入暂存区

工作目录中除已跟踪文件以外的所有其它文件都属于未跟踪文件，它们既不存在于上次快照的记录中，也没有放入暂存区



编辑过某些文件之后，由于自上次提交后你对它们做了修改，Git 将它们标记为已修改文件



1. **检查当前文件状态**

要查看哪些文件处于什么状态，可以用 `git status` 命令

创建新的文件后，使用git status将看到一个新的未跟踪文件



2. **跟踪新文件**

使用命令 `git add` 开始跟踪一个文件

```c
git add README
```



`git add` 命令使用文件或目录的路径作为参数；如果参数是目录的路径，该命令将递归地跟踪该目录下的所有文件



3. **暂存已修改文件**

要暂存这次更新，需要运行 `git add` 命令

这是个多功能命令：

* 可以用它开始跟踪新文件
* 或者把已跟踪的文件放到暂存区
* 还能用于合并时把有冲突的文件标记为已解决状态等



运行了 `git add` 之后又作了修订的文件，需要重新运行 `git add` 把最新版本重新暂存起来



4. **状态简览**

使用 `git status -s` 命令或 `git status --short` 命令，你将得到一种更为紧凑的格式输出



* 新添加的未跟踪文件前面有 `??` 标记
* 新添加到暂存区中的文件前面有 `A` 标记
* 修改过的文件前面有 `M` 标记
  * 出现在右边的 `M` 表示该文件被修改了但是还没放入暂存区
  * 出现在靠左边的 `M` 表示该文件被修改了并放入了暂存区



5. **忽略文件**

可以创建一个名为 `.gitignore` 的文件，列出要忽略的文件模式

```c
cat .gitignore
*.[oa]
*~
```

第二行告诉 Git 忽略所有以 `.o` 或 `.a` 结尾的文件

第三行告诉 Git 忽略所有以波浪符（~）结尾的文件



.gitignore格式规范：

* 所有空行或者以 `＃` 开头的行都会被 Git 忽略
* 可以使用标准的 glob 模式匹配
* 匹配模式可以以（`/`）开头防止递归
* 匹配模式可以以（`/`）结尾指定目录
* 要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（`!`）取反



5. **查看已暂存和未暂存的修改**

想知道具体修改了什么地方，可以用 `git diff` 命令

此命令比较的是工作目录中当前文件和暂存区域快照之间的差异， 也就是修改之后还没有暂存起来的变化内容



若要查看已暂存的将要添加到下次提交里的内容，可以用 `git diff --cached` 命令



6. **提交更新**

现在的暂存区域已经准备妥当可以提交了

 在此之前，请一定要确认还有什么修改过的或新建的文件还没有 `git add` 过，否则提交的时候不会记录这些还没暂存起来的变化



 这些修改过的文件只保留在本地磁盘

 所以，每次准备提交前，先用 `git status` 看下，是不是都已暂存起来了， 然后再运行提交命令 `git commit`



可以在 `commit` 命令后添加 `-m` 选项，将提交信息与命令放在同一行

```c
git commit -m "测试git提交功能"
```



7. **跳过使用暂存区域**

只要在提交的时候，给 `git commit` 加上 `-a` 选项，Git 就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过 `git add` 步骤

```c
git commit -a -m '测试'
```



8. **移除文件**

要从 Git 中移除某个文件，就必须要从已跟踪文件清单中移除（确切地说，是从暂存区域移除），然后提交

可以用 `git rm` 命令完成此项工作，并连带从工作目录中删除指定的文件，这样以后就不会出现在未跟踪文件清单中了



果删除之前修改过并且已经放到暂存区域的话，则必须要用强制删除选项 `-f`



我们想把文件从 Git 仓库中删除（亦即从暂存区域移除），但仍然希望保留在当前工作目录中，使用 `--cached` 选项

```c
git rm --cached
```



`git rm` 命令后面可以列出文件或者目录的名字，也可以使用 `glob` 模式

```c
git rm log/\*.log
```

注意到星号 `*` 之前的反斜杠 `\`， 因为 Git 有它自己的文件模式扩展匹配方式，所以我们不用 shell 来帮忙展开。 此命令删除 `log/` 目录下扩展名为 `.log` 的所有文件



9. **移动文件**

Git 并不显式跟踪文件移动操作

 如果在 Git 中重命名了某个文件，仓库中存储的元数据并不会体现出这是一次改名操作



 要在 Git 中对文件改名，可以这么做：

```c
git mv file_from file_to
```

git mv相当于运行了下面三条命令：

```c
mv README.md README
git rm README.md
git add README
```



## 2.3 查看提交历史

回顾提交历史最简单而有效的工具是`git log` 命令

默认不用任何参数的话，`git log` 会按提交时间列出所有的更新，最近的更新排在最上面

这个命令会列出每个提交的 SHA-1 校验和、作者的名字和电子邮件地址、提交时间以及提交说明



一个常用的选项是 `-p`，用来显示每次提交的内容差异。 你也可以加上 `-2` 来仅显示最近两次提交

```c
git log -p -2
```

该选项除了显示基本信息之外，还附带了每次 commit 的变化



如果你想看到每次提交的简略的统计信息，你可以使用 `--stat` 选项

```c
git log --stat
```



另外一个常用的选项是 `--pretty`

这个选项可以指定使用不同于默认格式的方式展示提交历史

这个选项有一些内建的子选项供你使用。 比如用 `oneline` 将每个提交放在一行显示， 另外还有 `short`，`full` 和 `fuller` 可以用，format可以定制要显示的记录格式

```c
git log --pretty=oneline
```



作者指的是实际作出修改的人，提交者指的是最后将此工作成果提交到仓库的人



当 oneline 或 format 与另一个 `log` 选项 `--graph` 结合使用时尤其有用

这个选项添加了一些ASCII字符串来形象地展示你的分支、合并历史

```c
git log --pretty=format:"%h %s" --graph
```



1. **限制输出长度**

按照时间作限制的选项，比如 `--since` 和 `--until` 也很有用

例如，下面的命令列出所有最近两周内的提交：

```c
git log --since=2.weeks
```



这个命令可以在多种格式下工作，比如说具体的某一天 `"2008-01-15"`，或者是相对地多久以前 `"2 years 1 day 3 minutes ago"`



还可以给出若干搜索条件，列出符合的提交

 用 `--author` 选项显示指定作者的提交

用 `--grep` 选项搜索提交说明中的关键字

（请注意，如果要得到同时满足这两个选项搜索条件的提交，就必须用 `--all-match` 选项。否则，满足任意一个条件的提交都会被匹配出来）



另一个非常有用的筛选选项是 `-S`，可以列出那些添加或移除了某些字符串的提交

```c
git log -Sfunction_name
```



最后一个很实用的 `git log` 选项是路径(path)， 如果只关心某些文件或者目录的历史提交，可以在 git log 选项的最后指定它们的路径

因为是放在最后位置上的选项，所以用两个短划线（--）隔开之前的选项和后面限定的路径名



## 2.4 撤销操作

注意，有些撤消操作是不可逆的

这是在使用 Git 的过程中，会因为操作失误而导致之前的工作丢失的少有的几个地方之一



有时候我们提交完了才发现漏掉了几个文件没有添加，或者提交信息写错了。 此时，可以运行带有 `--amend` 选项的提交命令尝试重新提交

```c
git commit --amend
```

这个命令会将暂存区中的文件提交

如果未做任何修改，那么快照会保持不变，而你所修改的只是提交信息



例如，忘记了暂存某些需要的修改：

```c
git commit -m "initial commit"
git add forgotten_file
git commit -amend
```

最终你只会有一个提交 ， 第二次提交将代替第一次提交的结果



1. **取消暂存的文件**

这些命令在修改文件状态的同时，也会提示如何撤消操作

 例如，你已经修改了两个文件并且想要将它们作为两次独立的修改提交，但是却意外地输入了 `git add *` 暂存了它们两个

使用`git reset HEAD <file>…` 来取消暂存

```c
git reset HEAD CONTRIBUTING.md
```



2. **撤销对文件的修改**

使用git checkout -- <file> ..撤销对文件的修改

```c
git checkout -- CONTRIBUTING.md
```



## 2.5 远程仓库的使用

远程仓库是指托管在因特网或其他网络中的你的项目的版本库

管理远程仓库包括了解如何添加远程仓库、移除无效的远程仓库、管理不同的远程分支并定义它们是否被跟踪等等



1. **查看远程仓库**

如果想查看你已经配置的远程仓库服务器，可以运行 `git remote` 命令

 如果你已经克隆了自己的仓库，那么至少应该能看到 origin - 这是 Git 给你克隆的仓库服务器的默认名字

你也可以指定选项 `-v`，会显示需要读写远程仓库使用的 Git 保存的简写与其对应的 URL



































