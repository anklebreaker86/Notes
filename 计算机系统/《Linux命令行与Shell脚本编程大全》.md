# 第一章 初识Linux shell

## 1.1 Linux初探

Linux系统可划分为以下4部分：

* Linux内核
* GNU工具
* 图形化桌面环境
* 应用软件



1. **深入探究Linux内核**

Linux系统的核心是内核

内核控制着计算机系统的所有硬件和软件，在必要时分配硬件，并根据需要执行软件



内核主要负责以下4种功能：

* 系统内存管理
* 软件程序管理
* 硬件设备管理
* 文件系统管理



**系统内存管理**

内核不仅管理服务器上的可用物理内存，还可以创建并管理虚拟内存（实际并不存在的内存）

内核通过硬盘上称为交换空间（swap space）的存储区域来实现虚拟内存



内核在交换空间和实际的物理内存之间反复交换虚拟内存中的内容

这使得系统以为自己拥有比物理内存更多的可用内存，



内存被划分为若干块，这些块称作页面（page）

内核会将每个内存页面置于物理内存或交换空间中

内核会维护一张内存页面表，指明哪些页面位于物理内存，哪些页面被交换到了磁盘



==磁盘长期存储数据设备，物理内存和交换空间临时存储数据，物理内存不足时就会使用交换空间存储数据==



自动把一段时间未访问的内存页面复制到交换空间区域（称之为换出，swapping out）

当程序要访问一个已被换出的内存页面时，内核必须将物理内存中的另一个页面换出来为其腾出空间，然后从交换空间换入（swapping in）所请求的页面

只要Linux系统在运行，为运行中的程序换出内存页面的过程就不会停歇。



**软件程序管理**

Linux操作系统称运行中的程序为进程

进程可以在前台运行，将输出显示在屏幕上；也可以在后台运行，隐藏到幕后



内核创建了第一个进程（称为==init进程==）来启动系统中所有其他进程

当内核启动时，它会将init进程载入虚拟内存

内核在启动其他进程时，会在虚拟内存中给新进程分配一块专有区域来存储该进程用到的数据和代码



Linux中有多种init进程实现，最流行的是：

* SysVinit：Linux最初使用，如今只有一些比较旧的发行版使用
* systemd：已成为Linux发行版中最流行的初始化和进程管理系统



systemd初始化方法得以流行起来的原因在于能够根据不同的事件启动进程

如系统启动时、连接到特定的硬件设备时、服务启动时、建立好网络连接时



systemd方法通过将事件与单元文件（unit file）链接来决定运行哪些进程

每个单元文件定义了特定事件发生时要启动的程序

systemctl程序允许启动、停止和列出系统中当前运行的单元文件



systemd方法将单元文件划归为目标（target）

目标定义了Linux系统的特定运行状态，这和SysVinit运行级的概念类似

在系统启动时，default.target单元定义了要启动的所有单元文件



使用systemctl查看当前默认目标

```javascript
$systemctl get-default
```



**硬件设备管理**

任何Linux系统需要与之通信的设备都必须在内核代码中加入其驱动程序

驱动程序相当于应用程序和硬件设备的“中间人”



向Linux内核中插入设备驱动的方法有两种：

* 将驱动程序编译入内核
* 将设备驱动模块加入内核



以前，插入设备驱动程序的唯一途径就是重新编译内核

每次给系统添加新设备时，都不得不重新编译一遍内核代码

开发人员提出了内核模块的概念，允许在无须重新编译内核的情况下将驱动程序插入运行中的内核

当设备不再使用时也可将内核模块从内核中移走



Linux系统将硬件设备视为一种特殊文件，称为设备文件

设备文件分为三种：

* 字符设备文件：每次只能处理一个字符的设备，大多数类型的调制解调器和终端
* 块设备文件：每次以块形式处理数据的设备，比如硬盘驱动器
* 网络设备文件：采用数据包发送和接收数据的设备，这包括网卡和一个特殊的环回设备，后者允许Linux系统使用常见的网络编程协议同自身通信



Linux会为系统的每个设备都创建一种称为“节点”的特殊文件

与设备的所有通信都是通过设备节点完成的

每个节点都有一个唯一的数值对，以供Linux内核标识，数值对包括一个主设备号和一个次设备号

类似的设备会被划分到相同的主设备号下，次设备号用于标识主设备组下的某个特定设备



**文件系统管理**

Linux内核支持通过不同类型的文件系统读写硬盘数据

除了自有的多种文件系统，Linux还能够读写其他操作系统（比如Microsoft Windows）的文件系统

内核必须在编译时就加入对所有要用到的文件系统的支持



Linux内核采用虚拟文件系统（virtual file system，VFS）作为和各种文件系统交互的接口

这为Linux内核与其他类型文件系统之间的通信提供了一个标准接口



2. **GNU实用工具**

除了由内核来控制硬件设备，操作系统还需要实用工具来实现各种标准功能，比如控制文件和程序



Linus的Linux内核和GNU操作系统实用工具结合在一起，产生了一款完整且功能丰富的自由操作系统

通常将Linux内核和GNU实用工具的结合体称为Linux，也会将其称为GNU/Linux系统，借此致意GNU组织所做的贡献



**核心GNU使用工具**

供Linux系统使用的这组核心工具被称为coreutils（core utilities）软件包

该软件包由3部分构成：

* 文件实用工具
* 文本实用工具
* 进程实用工具



**shell**

GNU/Linux shell是一种特殊的交互式工具

为用户提供了启动程序、管理文件系统中的文件以及运行在Linux系统中的进程的途径



shell的核心是命令行提示符，负责shell的交互部分，允许用户输入文本命令，然后解释命令并在内核中执行



shell包含一组内部命令，可用于完成复制文件、移动文件、重命名文件、显示和终止系统中正在运行的程序这类操作

shell也允许在命令行提示符中输入程序的名称，它会将程序名称传递给内核以启动程序



也可以将多个shell命令放入文件中作为程序执行

这些文件称作shell脚本

凡是能在命令行中执行的命令都可放入shell脚本中作为一组命令执行



所有Linux发行版默认的shell都是bash shell

除了base shell，还有ash、korn、tcsh和zsh



## 1.2 Linux发行版

我们将完整的Linux系统包称为发行版

不同的Linux发行版通常分为两类：

* 完整的核心Linux发行版
* 特定用途的Linux发行版



1. **核心Linux发行版**

核心Linux发行版含有内核、一个或多个图形化桌面环境以及预编译好的大部分可用的Linux应用程序



2. **特定用途的Linux发行版**

它们通常基于某个主流发行版，但仅包含其中一部分用于某种特定用途的应用程序





# 第二章   走进shell

## 2.1 进入命令行

命令行界面（command line interface，CLI）只允许输入文本，而且只能显示文本和基本图形输出



1. **控制台终端**

进入CLI的一种途径是访问Linux系统的文本模式

该模式只在显示器上提供一个简单的shell CLI，就跟图形化桌面出现之前那样，称为Linux控制台



2. **图形化终端**

虚拟控制台终端的另一种替代方案是使用Linux图形化桌面环境中的终端仿真软件包



## 2.2 通过Linux控制台终端访问CLI

在大多数Linux发行版中，通常必须按下Ctrl+Alt组合键，然后再按一个功能键（F1～F7）来进入你要使用的虚拟控制台

Ubuntu和CentOS均使用F1键



在图形化环境中，在你输入密码的时候会看到点号或者星号。但是在虚拟控制台中，输入密码的时候什么都不会显示



虚拟控制台可以修改文字和背景色，例如setterm --inversescreen on



## 2.3 通过图形化终端仿真器访问CLI

在图形化环境下，有大量可用的终端仿真器

每个软件包都有各自独特的特性以及选项

有GNOME Terminal、Konsole和xterm等



## 2.4 使用GNOME Terminal终端仿真器

GNOME Terminal是GNOME Shell桌面环境的默认终端仿真器



1. **访问GNOME Terminal**

在左上角活动中搜索终端



2. **菜单栏**

GNOME Terminal的菜单栏包含配置选项和定制选项

shift + ctrl +c  复制

shift + ctrl + v 粘贴

shift + ctrl +f 搜索



# 第三章   base shell基础命令

## 3.1 启动shell

GNU bash shell是一个程序，提供了对Linux系统的交互式访问

它是作为普通程序运行的，通常是在用户登录终端时启动



/etc/passwd文件包含了所有系统用户账户以及每个用户的基本配置信息

使用cat   /etc/passwd指令获取信息，从中摘取样例条目为：

```c
galaxy:x:1000:1000:galaxy,,,:/home/galaxy:/bin/bash
```

每个条目包含7个数据字段，字段之间用冒号分隔

系统使用字段中的数据来赋予用户账户某些特性

最后一个字段上指定了用户使用的shell程序



在上面样例条目中，用户galaxy将/bin/bash作为自己的默认shell程序

在galaxy登录Linux系统后，GNU bash shell会自行启动



## 3.2 使用shell提示符

默认的bash shell提示符是美元符号（$），这个符号表明shell在等待用户输入命令

提示符中显示了当前用户名galaxy，还包括Ubuntu系统的主机名



## 3.3 与bash手册交互

大多数Linux发行版自带在线手册，可用于查找shell命令以及其他GNU实用工具的相关信息

man命令可以访问Linux系统的手册页

在man命令之后跟上想要查看的命令名，就可以显示相应的手册页，例如输入 man  hostname



使用man命令查看命令手册页的时候，其中的信息是由分页程序（pager）来显示的

分页程序是一种实用工具，能够逐页（或逐行）显示文本

可以单击空格键进行翻页，或是使用Enter键逐行查看

也可以使用箭头键向前和向后滚动手册页的内容

如果阅读完毕，可以按q键退出手册页



Linux手册页段名：

|      段       |          描述          |
| :-----------: | :--------------------: |
|     Name      |  显示命令名和简短描述  |
|   SYNOPSIS    |     命令语法，概述     |
| CONFIGURATION |      命令配置信息      |
|  DESCRIPTION  |     命令一般性描述     |
|    OPTIONS    |      命令选项描述      |
|  EXIT STATUS  |      命令推出状态      |
| RETURN VALUE  |       命令返回值       |
|    ERRORS     |      命令错误消息      |
|  ENVIRONMENT  |    命令使用环境变量    |
|     FILES     |      命令用到文件      |
|   VERSIONS    |      命令版本信息      |
| CONFORMING TO |     遵循的命名标准     |
|     NOTES     |     其他有帮助资料     |
|     BUGS      |     提交bug的途径      |
|    EXAMPLE    |      命令用法示例      |
|   SEE ALSO    | 与该命令类似的其他命令 |



很多命令基本模式如下：

```c
COMMAND-NAME [OPTION]... [ARGUMENT]...
```

* COMMAND-NAME：要运行的命令名
* OPTION：是用于修改命令行为的选项，可添加的OPTION通常不止一个，中括号[]表示OPTION并不是必需的，3个点号...表示可以一次指定多个OPTION
* ARGUMENT：传递给命令的参数，以指明命令的操作对象



如果想使用多个命令选项，那么通常可以将其合并在一起。例如，要使用选项-a和-b，可以写作-ab



如果不记得命令名了，可以使用关键字来搜索手册页

语法为man -k keyword



除了按照惯例命名的各段，手册页中还有不同的节

每节都分配了一个数字，从1开始，一直到9

一个命令偶尔会在多个节中都有对应的手册页，通常默认显示编号最低的节

如果想查看特定节，可以输入man section topicname



也可以只看各节内容的简介，输入man 1 intro来阅读第1节



手册页并非唯一的参考资料

还有另一种称作info页面的信息，可以输入info info来了解info页面的相关内容

有关帮助页面的更多信息，可以输入help help



另外，大多数命令接受-h或--help选项。例如，可以输入hostname --help来查看简要的帮助信息



## 3.4 浏览文件系统

当登录系统并获得shell命令提示符后，你通常位于自己的主目录中



1. **Linux文件系统**

Linux的路径中不使用驱动器盘符

Windows会为每个物理磁盘分区分配一个盘符，每个分区都有自己的目录结构，用于访问存储在其中的文件

Linux会将文件存储在名为虚拟目录（virtual directory）的单个目录结构中

虚拟目录会将计算机中所有存储设备的文件路径都纳入单个目录结构



Linux虚拟目录结构只包含一个称为根（root）目录的基础目录

根目录下的目录和文件会按照其访问路径一一列出，这点跟Windows类似



Linux使用正斜线（/）而不是反斜线（\）来分隔文件路径中的目录

反斜线在Linux中用作转义字符，如果误用在文件路径中会造成各种各样的问题



```c
/home/rich/Documents/test.doc
```

这表明文件test.doc位于Documents目录，该目录位于rich目录，而rich目录则包含在home目录

路径本身并没有提供任何有关文件究竟存放在哪个物理磁盘中的信息



我们称在Linux系统中安装的第一块硬盘为根驱动器

根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的



Linux会使用根驱动器上一些特别的目录作为挂载点（mount point）

挂载点是虚拟目录中分配给额外存储设备的目录

Linux会让文件和目录出现在这些挂载点目录中，即便它们位于其他物理驱动器中



系统文件通常存储在根驱动器中，而用户文件则存储在其他驱动器中，如下图

![image-20231224163811052](https://raw.githubusercontent.com/anklebreaker86/pictures/master/202312241650494.png)

Disk 1与虚拟目录的根目录关联，其他硬盘可以挂载到虚拟目录结构中的任何地方

Disk 2被挂载到了/home，这是用户主目录所在的位置



在Linux文件系统中，采用通用的目录名表示一些常见的功能

|   目录   |                       用途                       |
| :------: | :----------------------------------------------: |
|    /     |             根目录，不会在这放置文件             |
|   /bin   |      二进制文件目录，存放用户级GNU实用工具       |
|  /boot   |              引导目录，放置引导文件              |
|   /dev   |        设备目录，Linux在其中创建设备节点         |
|   /etc   |                 系统配置文件目录                 |
|  /home   |         主目录，Linux在其中创建用户目录          |
|   /lib   |        库目录，存放系统和应用程序的库文件        |
| /libname |     库目录，存放替代格式的系统和应用程序文件     |
|  /media  |       媒介目录，可移动存储设备的常用挂载点       |
|   /mnt   |    挂载目录，用于临时挂载文件系统的常用挂载点    |
|   /opt   |            可选目录，存放第三方软件包            |
|  /proc   |  进程目录，存放现有内核、系统以及进程的相关信息  |
|  /root   |                 root用户的主目录                 |
|   /run   |          运行目录，存放系统的运行时数据          |
|  /sbin   | 系统二进制文件目录，存放了很多管理级GNU实用工具  |
|   /srv   |         服务目录，存放本地服务的相关文件         |
|   /sys   | 系统目录，存放设备、驱动程序以及部分内核特性信息 |
|   /tmp   |    临时目录，可以在其中创建和删除临时工作文件    |
|   /usr   |           用户目录，一个次目录层级结构           |
|   /var   |    可变目录，存放经常变化的文件，比如日志文件    |



/usr目录值得特别关注，因为该目录是一个次目录层级结构，包含可共享的只读文件

其中有用户命令、源代码文件、游戏，等等



常见的Linux目录名均基于文件系统层级标准（filesystem hierarchy standard，FHS）



当你登录系统并获得shell CLI提示符后，shell会话会从你的主目录开始

主目录是分配给用户账户的一个特有目录



2. **遍历目录**

在Linux文件系统中，可以使用目录切换（cd）命令来将shell会话切换到另一个目录

如果没有为cd命令指定目标路径，则会切换到你的用户主目录

```c
cd destination
```



destination参数可以用两种方式表示：一种是绝对路径，另一种是相对路径



绝对路径总是以正斜线（/）作为起始，以指明虚拟文件系统的根目录

相当于目录的全名

```c
galaxy@galaxy-virtual-machine:~$ cd /usr/bin
galaxy@galaxy-virtual-machine:/usr/bin$
```

波浪号表明shell会话当前位于你的主目录中



pwd命令可以显示出shell会话的当前目录，该目录被称为当前工作目录

```c
galaxy@galaxy-virtual-machine:/usr/bin$ pwd
/usr/bin
```

在切换到新的当前工作目录时使用pwd命令，这是一个不错的习惯

因为很多shell命令是在当前工作目录中进行操作的，所以在发出命令之前，你应该总是确保自己处在正确的目录之中



相对路径允许你指定一个基于当前位置的目标路径

相对路径不以代表根目录的正斜线（/）开头，而是以目录名（如果你准备切换到当前工作目录下的某个目录的话）或是一个特殊字符开始

```c
galaxy@galaxy-virtual-machine:~$ cd 文档
galaxy@galaxy-virtual-machine:~/文档$ 
```



可以在任何包含子目录的目录中使用带有相对路径的cd命令，也可以使用特殊字符来表示相对目录位置

* 单点号（.），表示当前目录
* ·双点号（..），表示当前目录的父目录



## 3.5 列出文件和目录

要想知道系统中都有哪些文件，可以使用列表命令（ls）



1. **显示基本列表**

ls　命令最基本的形式会显示当前目录下的文件和目录

使用ls命令的-F选项来轻松地区分文件和目

```c
galaxy@galaxy-virtual-machine:~$ ls -F
公共的/  模板/  视频/  图片/  文档/  下载/  音乐/  桌面/  snap/
```

-F选项会在目录名之后添加正斜线（/），以方便用户在输出中分辨

还会再可执行文件后添加星号*































